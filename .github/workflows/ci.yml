name: CI - Instagram Bot

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  syntax-check:
    name: Python Syntax Check
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Python 3.10
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: Check Python syntax
      run: |
        echo "üîç Checking Python syntax..."
        python -m py_compile get_followers.py
        python -m py_compile send_direct.py
        python -m py_compile report.py
        echo "‚úÖ All Python files compiled successfully!"
        
    - name: Validate requirements.txt
      run: |
        echo "üìã Checking requirements.txt..."
        pip install -r requirements.txt
        echo "‚úÖ requirements.txt is valid!"

  security-scan:
    name: Security Basic Checks
    runs-on: ubuntu-latest
    needs: syntax-check
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Check for hardcoded secrets
      run: |
        echo "üîí Checking for potential secrets..."
        if grep -r "password\|token\|secret\|key" *.py --exclude-dir=.git; then
          echo "‚ö†Ô∏è  Warning: Possible hardcoded secrets found"
          echo "‚ÑπÔ∏è  Review the above lines for sensitive data"
        else
          echo "‚úÖ No obvious hardcoded secrets found"
        fi
        
    - name: Basic security check with Bandit
      run: |
        echo "üõ°Ô∏è Running basic security checks..."
        pip install bandit
        bandit -ll -r *.py || true

  documentation-check:
    name: Documentation Validation
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Check required files exist
      run: |
        echo "üìÑ Checking project structure..."
        [ -f "README.md" ] && echo "‚úÖ README.md exists" || echo "‚ùå README.md missing"
        [ -f "requirements.txt" ] && echo "‚úÖ requirements.txt exists" || echo "‚ùå requirements.txt missing"
        [ -f "LICENSE" ] && echo "‚úÖ LICENSE exists" || echo "‚ùå LICENSE missing"
        [ -f ".gitignore" ] && echo "‚úÖ .gitignore exists" || echo "‚ùå .gitignore missing"
        
    - name: Validate README structure
      run: |
        echo "üìñ Checking README structure..."
        if grep -q "Instagram Automation Bot" README.md; then
          echo "‚úÖ README title found"
        else
          echo "‚ö†Ô∏è  README title might be missing"
        fi
